<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rainfall in Australia</title>

  <!-- Vega libs -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <h2>National Annual Rainfall</h2>
  <div id="trend"></div>

  <h2>Top 10 Locations (by year)</h2>
  <div id="toploc"></div>

  <h2>Rainfall by State (Choropleth)</h2>
  <div id="map"></div>

  <!-- ========== trend  ========== -->
  <script type="application/json" id="spec-trend">
  {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 800,
    "height": 300,
    "title": "Average Annual Rainfall — Australia (2008–2017)",
    "data": { "url": "rainfall_timeseries.csv" },
    "transform": [
      { "filter": "datum.Year >= 2008 && datum.Year <= 2017" }
    ],
    "mark": { "type": "line", "point": true },
    "encoding": {
      "x": { "field": "Year", "type": "quantitative", "title": "Year" },
      "y": { "field": "rain_mm", "type": "quantitative", "title": "Rainfall (mm)" },
      "tooltip": [
        { "field": "Year", "type": "quantitative" },
        { "field": "rain_mm", "type": "quantitative", "format": ".2f", "title": "Avg (mm)" }
      ]
    }
  }
  </script>

  <!-- ========== top locations with slider ========== -->
  <script type="application/json" id="spec-toploc">
  {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 800,
    "height": 420,
    "title": "Top 10 Locations by Average Rainfall",
    "params": [
      { "name": "year_sel", "value": 2017,
        "bind": { "input": "range", "min": 2008, "max": 2017, "step": 1 } }
    ],
    "data": { "url": "rainfall_by_location.csv" },
    "transform": [
      { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
      { "filter": "datum.YearNum == year_sel" },
      { "window": [{ "op": "rank", "as": "rank" }],
        "sort": [{ "field": "rain_mm", "order": "descending" }] },
      { "filter": "datum.rank <= 10" }
    ],
    "mark": "bar",
    "encoding": {
      "y": { "field": "Location", "type": "nominal", "sort": "-x", "title": null },
      "x": { "field": "rain_mm", "type": "quantitative", "title": "Avg rainfall (mm)" },
      "tooltip": [
        { "field": "Location", "type": "nominal" },
        { "field": "rain_mm", "type": "quantitative", "format": ".1f", "title": "Avg (mm)" }
      ]
    }
  }
  </script>

  <!-- ==========  map ========== -->
  <script type="application/json" id="spec-map">
  {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 900,
    "height": 500,
    "title": "Rainfall by State — 2017",
    "data": {
      "url": "AUS_states.json",
      "format": { "type": "topojson", "feature": "AUS_states" }
    },
    "transform": [
      {
        "lookup": "properties.STATE_NAME",
        "from": {
          "data": { "url": "rainfall_by_state_2017.csv" },
          "key": "State",
          "fields": ["rain_mm"]
        }
      }
    ],
    "projection": { "type": "equalEarth" },
    "mark": { "type": "geoshape", "stroke": "white" },
    "encoding": {
      "color": {
        "field": "rain_mm",
        "type": "quantitative",
        "title": "Avg rainfall (mm)",
        "scale": { "scheme": "blues" }
      },
      "tooltip": [
        { "field": "properties.STATE_NAME", "type": "nominal", "title": "State" },
        { "field": "rain_mm", "type": "quantitative", "format": ".2f", "title": "Avg (mm)" }
      ]
    }
  }
  </script>

  <!-- ========== Embed the three specs ========== -->
  <script>
    const trendSpec  = JSON.parse(document.getElementById('spec-trend').textContent);
    const toplocSpec = JSON.parse(document.getElementById('spec-toploc').textContent);
    const mapSpec    = JSON.parse(document.getElementById('spec-map').textContent);

    vegaEmbed('#trend',  trendSpec,  {actions:false});
    vegaEmbed('#toploc', toplocSpec, {actions:false});
    vegaEmbed('#map',    mapSpec,    {actions:false});
  </script>
</body>
</html>



